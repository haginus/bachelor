@if (isLoading) {
  <app-loading class="loading-container"></app-loading>
}

@if (data.mode == 'create') {
  <div mat-dialog-title>Adăugați domeniu</div>
}
@if (data.mode == 'edit') {
  <div mat-dialog-title>Editați domeniul</div>
}
@if (data.mode == 'delete') {
  <div mat-dialog-title>Ștergeți domeniul?</div>
}

@if (data.mode == 'edit' || data.mode == 'create') {
  <mat-dialog-content class="mat-typography">
    <form [formGroup]="editDomainForm" autocomplete="off">
      <mat-form-field appearance="outline" subscriptSizing="fixed">
        <mat-label>Nume domeniu</mat-label>
        <input matInput type="text" formControlName="name" name="domainName">
      </mat-form-field>
      <div fxLayout="row" fxLayoutGap="12px">
        <mat-form-field appearance="outline" subscriptSizing="fixed" fxFlex="50">
          <mat-label>Tip</mat-label>
          <mat-select formControlName="type" (valueChange)="paperType.setValue(null)">
            <mat-option value="bachelor">Licență</mat-option>
            <mat-option value="master">Master</mat-option>
          </mat-select>
        </mat-form-field>
        <mat-form-field appearance="outline" subscriptSizing="fixed" fxFlex="50">
          <mat-label>Tip lucrare</mat-label>
          <mat-select formControlName="paperType">
            @if (domainType.value == 'bachelor') {
              <mat-option value="bachelor">
                Lucrare de {{ PAPER_TYPES['bachelor'] }}
              </mat-option>
            }
            @if (domainType.value == 'bachelor') {
              <mat-option value="diploma">
                Lucrare de {{ PAPER_TYPES['diploma'] }}
              </mat-option>
            }
            @if (domainType.value == 'master') {
              <mat-option value="master">
                Lucrare de {{ PAPER_TYPES['master'] }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      <mat-slide-toggle formControlName="hasWrittenExam" color="primary">
        Probă scrisă
      </mat-slide-toggle>
      <div formArrayName="specializations">
        <h3>Programe de studii</h3>
        @for (specialization of formSpecializations.controls; track specialization; let i = $index) {
          <mat-card class="specialization-card" [formGroupName]="i">
            <div fxLayout="row grid" fxLayoutGap="12px grid">
              <mat-form-field appearance="outline" fxFlex="100">
                <mat-label>Nume program de studiu</mat-label>
                <input matInput type="text" formControlName="name" name="specializationName">
              </mat-form-field>
              <mat-form-field appearance="outline" fxFlex="30">
                <mat-label>Ani de studiu</mat-label>
                <input matInput type="number" formControlName="studyYears" min="1">
              </mat-form-field>
              <mat-form-field appearance="outline" fxFlex="70">
                <mat-label>Forma de învățământ</mat-label>
                <mat-select formControlName="studyForm">
                  <mat-option value="if">Învățământ cu frecvență</mat-option>
                  <mat-option value="ifr">Învățământ cu frecvență redusă</mat-option>
                  <mat-option value="id">Învățământ la distanță</mat-option>
                </mat-select>
              </mat-form-field>
              <mat-form-field appearance="outline" fxFlex="100" fxFlex.gt-xs="60">
                <mat-label>Nume în catalog</mat-label>
                <input matInput type="text" formControlName="catalogName" name="specializationCatalogName">
              </mat-form-field>
              <mat-form-field appearance="outline" fxFlex="100" fxFlex.gt-xs="40">
                <mat-label>Secretar</mat-label>
                <mat-select formControlName="secretaryId">
                  <mat-option [value]="null">-- Niciunul --</mat-option>
                  @for (secretary of secretaries(); track secretary) {
                    <mat-option [value]="secretary.id">
                      {{ secretary.lastName }} {{ secretary.firstName }}
                    </mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>
            <span
              class="delete-button"
              [matTooltip]="specialization.get('studentNumber')?.value > 0 ? 'Mutați întâi studenții la alt program de studiu.' : ''"
            >
              <button
                matButton="outlined"
                color="warn"
                (click)="$event.preventDefault(); removeSpecialization(i)"
                [disabled]="specialization.get('studentNumber')?.value > 0"
              >
                <mat-icon>delete</mat-icon>
                <span>Ștergeți</span>
              </button>
            </span>
          </mat-card>
        }
        <div fxLayout="column" fxLayoutAlign="center center">
          <button mat-stroked-button (click)="$event.preventDefault(); addSpecialization()">
            Adăugați program de studiu
          </button>
        </div>
      </div>
    </form>
  </mat-dialog-content>
}
@if (data.mode == 'delete') {
  <mat-dialog-content class="mat-typography">
    <p>Sunteți sigur că doriți să ștergeți acest domeniu?</p>
  </mat-dialog-content>
}

<mat-dialog-actions align="end">
  <button mat-button mat-dialog-close>Anulați</button>
  @if (data.mode == 'create') {
    <button mat-button (click)="saveDomain()"
    [disabled]="editDomainForm.invalid">Adăugați</button>
  }
  @if (data.mode == 'edit') {
    <button mat-button (click)="saveDomain()"
    [disabled]="editDomainForm.invalid">Salvați</button>
  }
  @if (data.mode == 'delete') {
    <button mat-button (click)="deleteDomain()">Ștergeți</button>
  }
</mat-dialog-actions>
