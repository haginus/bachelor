<mat-menu #catalogFormatMenu="matMenu">
  <ng-template matMenuContent let-catalogName="catalogName">
    <button mat-menu-item (click)="openReportFile($any(catalogName + '_pdf'))">
      <mat-icon>picture_as_pdf</mat-icon>
      <span>Format PDF</span>
    </button>
    <button mat-menu-item (click)="openReportFile($any(catalogName + '_docx'))">
      <mat-icon>description</mat-icon>
      <span>Format DOCX</span>
    </button>
  </ng-template>
</mat-menu>

<mat-card>
  <mat-card-header>
    <mat-card-title>Cataloage</mat-card-title>
  </mat-card-header>
  <div class="list">
    <div class="list-item">
      <div class="content">
        <div>Generați catalogul final</div>
        <div>Conține notele studenților din această sesiune</div>
      </div>
      <button mat-stroked-button [matMenuTriggerFor]="catalogFormatMenu" [matMenuTriggerData]="{ catalogName: 'final_catalog' }">
        <span>Generați</span>
        <mat-icon>arrow_drop_down</mat-icon>
      </button>
    </div>
    <div class="list-item">
      <div class="content">
        <div>Generați catalogul centralizator</div>
        <div>Conține notele studenților din această sesiune care au fost declarați admiși</div>
      </div>
      <button mat-stroked-button [matMenuTriggerFor]="catalogFormatMenu" [matMenuTriggerData]="{ catalogName: 'centralizing_catalog' }">
        <span>Generați</span>
        <mat-icon>arrow_drop_down</mat-icon>
      </button>
    </div>
  </div>
</mat-card>

<mat-card>
  <mat-card-header>
    <mat-card-title>Liste lucrări</mat-card-title>
  </mat-card-header>
  <div class="list">
    <div class="list-item">
      <div class="content">
        <div>Generați listă lucrări înscrise</div>
        <div>Conține toate lucrările înscrise în această sesiune</div>
      </div>
      <button mat-stroked-button (click)="openReportFile('submitted_paper_list_xlsx')">
        Generați
      </button>
    </div>
    <div class="list-item">
      <div class="content">
        <div>Generați listă lucrări</div>
        <div>Conține toate lucrările din platformă</div>
      </div>
      <button mat-stroked-button (click)="openReportFile('paper_list_xlsx')">Generați</button>
    </div>
  </div>
</mat-card>

<mat-card>
  <mat-card-header>
    <mat-card-title>Raport sesiune</mat-card-title>
  </mat-card-header>
  <div class="list">
    @if(finalReportStatus?.status === 'in_progress') {
      <div class="list-item">
        <div class="content">
          <div>Generați raport sesiune</div>
          <div>Raportul este în curs de generare...</div>
        </div>
        <app-text-progress-spinner
          [mode]="finalReportStatus.progress ? 'determinate' : 'indeterminate'"
          [value]="finalReportStatus.progress * 100"
          [diameter]="32"
        />
      </div>
    } @else if(!finalReportStatus || !finalReportStatus.lastGeneratedAt) {
      <div class="list-item">
        <div class="content">
          <div>Generați raport sesiune</div>
          <div>Raportul cuprinde toate informațiile din platformă.</div>
        </div>
        <button mat-stroked-button (click)="generateFinalReport()">Generați</button>
      </div>
    } @else {
      <div class="list-item">
        <div class="content">
          <div>Descărcați raport sesiune</div>
          <div>Ultima dată generat pe {{ lastGeneratedOn }}</div>
        </div>
        <button mat-stroked-button (click)="getFinalReport()">Descărcați</button>
        <button mat-icon-button [matMenuTriggerFor]="regenerateMenu">
          <mat-icon>more_vert</mat-icon>
        </button>
      </div>
    }
  </div>
</mat-card>

<mat-menu #regenerateMenu="matMenu">
  <button mat-menu-item (click)="generateFinalReport()">
    <mat-icon>save</mat-icon>
    <span>Regenerați</span>
  </button>
</mat-menu>
