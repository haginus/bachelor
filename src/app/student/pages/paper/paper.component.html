<app-loading *ngIf="isLoadingInitialData" color="primary"></app-loading>

<mat-card class="paper-card" *ngIf="!isLoadingInitialData">
    <div class="paper-header">
        <div class="paper-header-content">
            <h1 class="paper-title">{{paper.title}}</h1>
            <h3 class="paper-type">
                <span *ngIf="paper.type == 'bachelor'">{{ 'STUDENT.PAPER.BACHELOR_PAPER' | translate }}</span>
                <span *ngIf="paper.type == 'master'">{{ 'STUDENT.PAPER.MASTER_PAPER' | translate }}</span>
            </h3>
            <p class="paper-description">{{ paper.description }}</p>
            <p class="paper-teacher">
                {{ 'STUDENT.PAPER.COORDINATING_TEACHER' | translate }}:
                {{paper.teacher.firstName}} {{paper.teacher.lastName}}</p>
        </div>
        <div class="paper-header-actions">
            <button mat-icon-button>
                <mat-icon>mode</mat-icon>
            </button>
        </div>
    </div>

    <!-- TIP CARD - NO STUDENT EXTRA DATA -->
    <div class="tip-card warning" *ngIf="studentExtraData == null && !isWaitingForDocumentGeneration">
        <mat-icon class="tip-icon">warning_amber</mat-icon>
        <div class="tip-card-content">
            {{ 'STUDENT.PAPER.FILL_IN_EXTRA_DATA_MESSAGE' | translate }}
        </div>
        <div class="tip-card-action">
            <button mat-button (click)="editStudentExtraData()">
                {{ 'STUDENT.PAPER.FILL_IN' | translate }}
            </button>
        </div>
    </div>

    <!-- TIP CARD - STUDENT EXTRA DATA EDIT -->
    <div class="tip-card success" *ngIf="studentExtraData && !isWaitingForDocumentGeneration">
        <mat-icon class="tip-icon">done</mat-icon>
        <div class="tip-card-content">
            {{ 'STUDENT.PAPER.DOCUMENTS_GENERATED_MESSAGE' | translate }}
        </div>
        <div class="tip-card-action">
            <button mat-button (click)="editStudentExtraData()">
            {{ 'STUDENT.PAPER.CHANGE_DATA' | translate }}
            </button>
        </div>
    </div>

    <!-- TIP CARD - Waiting document generation -->
    <div class="tip-card isGenerating" *ngIf="isWaitingForDocumentGeneration">
        <div class="tip-card-content">
            {{ 'STUDENT.PAPER.DOCUMENTS_GENERATING_MESSAGE' | translate }}
        </div>
        <mat-progress-bar mode="query" color="primary"></mat-progress-bar>
    </div>

    <mat-list class="document-list">
        <div mat-subheader>{{ 'STUDENT.PAPER.DOCUMENTS_HEADER' | translate }}</div>
        <mat-list-item *ngFor="let document of requiredDocuments">
            <span mat-list-icon>
                <mat-icon *ngIf="!documentMap[document.name].actionPending">description</mat-icon>
                <mat-spinner diameter="24" *ngIf="documentMap[document.name].actionPending"></mat-spinner>
            </span>
            <div mat-line>{{document.title}}</div>
            <div mat-line>
                <span *ngIf="documentMap[document.name].requiredTypes.copy">
                    <span *ngIf="!documentMap[document.name].actualTypes.copy">{{ 'STUDENT.PAPER.MISSING_DOCUMENT' | translate }}</span>
                    <span *ngIf="documentMap[document.name].actualTypes.copy">{{ 'STUDENT.PAPER.UPLOADED_DOCUMENT' | translate }}</span>
                </span>
                <span *ngIf="documentMap[document.name].requiredTypes.generated">
                    <span *ngIf="!documentMap[document.name].requiredTypes.signed">
                        <span *ngIf="documentMap[document.name].actualTypes.generated">{{ 'STUDENT.PAPER.GENERATED_DOCUMENT' | translate }}</span>
                        <span *ngIf="!documentMap[document.name].actualTypes.generated">{{ 'STUDENT.PAPER.MISSING_DOCUMENT' | translate }}</span>
                    </span>
                    <span *ngIf="documentMap[document.name].requiredTypes.signed">
                        <span *ngIf="documentMap[document.name].actualTypes.generated">
                            <span *ngIf="!documentMap[document.name].actualTypes.signed">{{ 'STUDENT.PAPER.DOCUMENT_NEEDS_SIGNATURE' | translate }}</span>
                            <span *ngIf="documentMap[document.name].actualTypes.signed">{{ 'STUDENT.PAPER.SIGNED_DOCUMENT' | translate }}</span>
                        </span>
                        <span *ngIf="!documentMap[document.name].actualTypes.generated">{{ 'STUDENT.PAPER.MISSING_DOCUMENT' | translate }}</span>
                    </span>
                </span>
            </div>
            <button 
                mat-stroked-button
                *ngIf="documentMap[document.name].requiredTypes.generated && documentMap[document.name].actualTypes.generated && !documentMap[document.name].requiredTypes.signed"
                (click)="viewDocument(documentMap[document.name])" [disabled]="documentMap[document.name].actionPending">
                {{ 'STUDENT.PAPER.VIEW_DOCUMENT' | translate }}
            </button>
            <button 
                mat-stroked-button
                *ngIf="documentMap[document.name].requiredTypes.generated && documentMap[document.name].actualTypes.generated && documentMap[document.name].requiredTypes.signed && !documentMap[document.name].actualTypes.signed"
                (click)="openDocumentDialog('sign', document.name, documentMap[document.name].lastId)">
                {{ 'STUDENT.PAPER.SIGN_DOCUMENT' | translate }}
            </button>
            <button 
                mat-stroked-button
                *ngIf="documentMap[document.name].requiredTypes.signed && documentMap[document.name].actualTypes.signed"
                (click)="viewDocument(documentMap[document.name])" [disabled]="documentMap[document.name].actionPending">
                {{ 'STUDENT.PAPER.VIEW_DOCUMENT' | translate }}
            </button>
            <button 
                mat-stroked-button
                *ngIf="documentMap[document.name].requiredTypes.copy && !documentMap[document.name].actualTypes.copy"
                (click)="openDocumentDialog('uploadCopy', document.name)">
                {{ 'STUDENT.PAPER.UPLOAD_DOCUMENT' | translate }}
            </button>
            <button 
                mat-stroked-button
                *ngIf="documentMap[document.name].requiredTypes.copy && documentMap[document.name].actualTypes.copy"
                (click)="viewDocument(documentMap[document.name])" [disabled]="documentMap[document.name].actionPending">
                {{ 'STUDENT.PAPER.VIEW_DOCUMENT' | translate }}
            </button>
        </mat-list-item>
    </mat-list>
</mat-card>